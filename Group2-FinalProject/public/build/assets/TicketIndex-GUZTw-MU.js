import{d as R,r as f,c as G,o as z,a as y,b as t,u as s,h as J,w as l,e as a,f as i,q as Q,t as p,i as m,F as U,j as Y,p as K,k as W,n as X,l as H,g as Z}from"./app-BROu12nU.js";import{_ as h}from"./AppLayout.vue_vue_type_script_setup_true_lang-BDv_a608.js";import{_ as k}from"./index-C_7nduq-.js";import{_ as N}from"./index-BE-gfsH9.js";import{_ as ee,a as te,b as se,c as le,d as oe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B4fz9M_g.js";import{_ as re}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-D-gsSPPm.js";import{_ as j}from"./Input.vue_vue_type_script_setup_true_lang-Coo98h1g.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-CyM4qNL3.js";import{_ as ae}from"./Textarea.vue_vue_type_script_setup_true_lang-BE676KUH.js";import{_ as T,a as L,b as D,c as F,d as u}from"./SelectValue.vue_vue_type_script_setup_true_lang-B0jFY1N7.js";import"./index-BMdsnYYQ.js";import"./VisuallyHidden-Bv5znWlI.js";import"./useForwardExpose-BNyMVrtm.js";import"./useForwardPropsEmits-DkhaOHi9.js";import"./index-BDXRdVD0.js";import"./check-CqkxZVO9.js";import"./useFormControl-CsNtCUd_.js";const ie={class:"flex flex-col gap-4 p-6"},ne={class:"flex items-center justify-between"},ue={class:"space-y-2"},de={class:"space-y-2"},fe={class:"space-y-2"},pe={class:"space-y-2"},me={class:"flex justify-end gap-2"},ve={class:"flex gap-4 items-end"},ye={class:"flex-1"},ce={class:"w-48"},ge={class:"w-48"},_e={class:"text-sm text-muted-foreground"},xe={key:0,class:"flex items-center justify-center py-12"},we={key:1,class:"flex flex-col items-center justify-center py-12 border border-dashed rounded-lg"},be={key:2,class:"flex flex-col items-center justify-center py-12 border border-dashed rounded-lg"},ke={key:3,class:"grid gap-4"},Ce=["onClick"],Ve={class:"flex items-start justify-between gap-4"},$e={class:"flex-1 space-y-1"},je={class:"flex items-center gap-2"},Te={class:"font-semibold"},Le={class:"text-sm text-muted-foreground line-clamp-2"},De={class:"flex items-center gap-4 text-xs text-muted-foreground"},Ye=R({__name:"TicketIndex",setup(Fe){const O=[{title:"Tickets",href:"/tickets"}],g=f([]),V=f(!0),_=f(!1),x=f(""),w=f("all"),b=f("all"),C=f(null),d=f({subject:"",description:"",priority:"Low"}),B=o=>{const e=o.target;e.files&&e.files[0]&&(C.value=e.files[0])},$=G(()=>{let o=[...g.value];if(x.value){const n=x.value.toLowerCase();o=o.filter(v=>v.subject.toLowerCase().includes(n)||v.description.toLowerCase().includes(n)||v.creator?.name.toLowerCase().includes(n))}w.value!=="all"&&(o=o.filter(n=>n.status===w.value)),b.value!=="all"&&(o=o.filter(n=>n.priority===b.value));const e={High:3,Medium:2,Low:1},r={Open:4,"In Progress":3,Resolved:2,Closed:1};return o.sort((n,v)=>{const S=(r[v.status]||0)-(r[n.status]||0);if(S!==0)return S;const M=(e[v.priority]||0)-(e[n.priority]||0);return M!==0?M:new Date(v.created_at).getTime()-new Date(n.created_at).getTime()}),o}),P=async()=>{try{V.value=!0;const o=await H.get("/api/tickets");g.value=Array.isArray(o.data)?o.data:[]}catch(o){console.error("Error fetching tickets:",o),g.value=[]}finally{V.value=!1}},I=async()=>{try{const o=new FormData;o.append("subject",d.value.subject),o.append("description",d.value.description),o.append("priority",d.value.priority),C.value&&o.append("attachment",C.value),await H.post("/api/tickets",o,{headers:{"Content-Type":"multipart/form-data"}}),_.value=!1,d.value={subject:"",description:"",priority:"Low"},C.value=null,await P()}catch(o){console.error("Error creating ticket:",o),console.error("Error response:",o.response?.data),alert(`Error: ${o.response?.data?.message||"Failed to create ticket"}`)}},q=o=>{Z.visit(`/tickets/${o}`)},A=o=>({Open:"default","In Progress":"secondary",Resolved:"outline",Closed:"destructive"})[o]||"default",E=o=>({High:"text-red-500",Medium:"text-yellow-500",Low:"text-green-500"})[o]||"";return z(()=>{P()}),(o,e)=>(m(),y(U,null,[t(s(J),{title:"Tickets"}),t(h,{breadcrumbs:O},{default:l(()=>[a("div",ie,[a("div",ne,[e[23]||(e[23]=a("div",null,[a("h1",{class:"text-3xl font-bold"},"Support Tickets"),a("p",{class:"text-muted-foreground"},"Manage and track your support requests")],-1)),t(s(ee),{open:_.value,"onUpdate:open":e[4]||(e[4]=r=>_.value=r)},{default:l(()=>[t(s(re),{"as-child":""},{default:l(()=>[t(s(k),null,{default:l(()=>[...e[10]||(e[10]=[i("Create Ticket",-1)])]),_:1})]),_:1}),t(s(te),null,{default:l(()=>[t(s(se),null,{default:l(()=>[t(s(le),null,{default:l(()=>[...e[11]||(e[11]=[i("Create New Ticket",-1)])]),_:1}),t(s(oe),null,{default:l(()=>[...e[12]||(e[12]=[i(" Fill out the form below to submit a new support ticket. ",-1)])]),_:1})]),_:1}),a("form",{onSubmit:Q(I,["prevent"]),class:"space-y-4"},[a("div",ue,[t(s(c),{for:"subject"},{default:l(()=>[...e[13]||(e[13]=[i("Subject",-1)])]),_:1}),t(s(j),{id:"subject",modelValue:d.value.subject,"onUpdate:modelValue":e[0]||(e[0]=r=>d.value.subject=r),placeholder:"Brief description of the issue",required:""},null,8,["modelValue"])]),a("div",de,[t(s(c),{for:"description"},{default:l(()=>[...e[14]||(e[14]=[i("Description",-1)])]),_:1}),t(s(ae),{id:"description",modelValue:d.value.description,"onUpdate:modelValue":e[1]||(e[1]=r=>d.value.description=r),placeholder:"Detailed explanation",required:"",rows:"4"},null,8,["modelValue"])]),a("div",fe,[t(s(c),{for:"priority"},{default:l(()=>[...e[15]||(e[15]=[i("Priority",-1)])]),_:1}),t(s(T),{modelValue:d.value.priority,"onUpdate:modelValue":e[2]||(e[2]=r=>d.value.priority=r)},{default:l(()=>[t(s(L),null,{default:l(()=>[t(s(D),{placeholder:"Select priority"})]),_:1}),t(s(F),null,{default:l(()=>[t(s(u),{value:"Low"},{default:l(()=>[...e[16]||(e[16]=[i("Low",-1)])]),_:1}),t(s(u),{value:"Medium"},{default:l(()=>[...e[17]||(e[17]=[i("Medium",-1)])]),_:1}),t(s(u),{value:"High"},{default:l(()=>[...e[18]||(e[18]=[i("High",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a("div",pe,[t(s(c),{for:"attachment"},{default:l(()=>[...e[19]||(e[19]=[i("Attachment (Optional)",-1)])]),_:1}),t(s(j),{id:"attachment",type:"file",accept:"image/*",onChange:B,class:"cursor-pointer"}),e[20]||(e[20]=a("p",{class:"text-xs text-muted-foreground"},"Upload a screenshot or photo (Max 2MB, JPG/PNG/GIF)",-1))]),a("div",me,[t(s(k),{type:"button",variant:"outline",onClick:e[3]||(e[3]=r=>_.value=!1)},{default:l(()=>[...e[21]||(e[21]=[i("Cancel",-1)])]),_:1}),t(s(k),{type:"submit"},{default:l(()=>[...e[22]||(e[22]=[i("Create",-1)])]),_:1})])],32)]),_:1})]),_:1},8,["open"])]),a("div",ve,[a("div",ye,[t(s(c),{for:"search"},{default:l(()=>[...e[24]||(e[24]=[i("Search",-1)])]),_:1}),t(s(j),{id:"search",modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=r=>x.value=r),placeholder:"Search by subject, description, or creator...",class:"mt-1"},null,8,["modelValue"])]),a("div",ce,[t(s(c),{for:"status-filter"},{default:l(()=>[...e[25]||(e[25]=[i("Status",-1)])]),_:1}),t(s(T),{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=r=>w.value=r)},{default:l(()=>[t(s(L),{id:"status-filter",class:"mt-1"},{default:l(()=>[t(s(D))]),_:1}),t(s(F),null,{default:l(()=>[t(s(u),{value:"all"},{default:l(()=>[...e[26]||(e[26]=[i("All Status",-1)])]),_:1}),t(s(u),{value:"Open"},{default:l(()=>[...e[27]||(e[27]=[i("Open",-1)])]),_:1}),t(s(u),{value:"In Progress"},{default:l(()=>[...e[28]||(e[28]=[i("In Progress",-1)])]),_:1}),t(s(u),{value:"Resolved"},{default:l(()=>[...e[29]||(e[29]=[i("Resolved",-1)])]),_:1}),t(s(u),{value:"Closed"},{default:l(()=>[...e[30]||(e[30]=[i("Closed",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a("div",ge,[t(s(c),{for:"priority-filter"},{default:l(()=>[...e[31]||(e[31]=[i("Priority",-1)])]),_:1}),t(s(T),{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=r=>b.value=r)},{default:l(()=>[t(s(L),{id:"priority-filter",class:"mt-1"},{default:l(()=>[t(s(D))]),_:1}),t(s(F),null,{default:l(()=>[t(s(u),{value:"all"},{default:l(()=>[...e[32]||(e[32]=[i("All Priorities",-1)])]),_:1}),t(s(u),{value:"High"},{default:l(()=>[...e[33]||(e[33]=[i("High",-1)])]),_:1}),t(s(u),{value:"Medium"},{default:l(()=>[...e[34]||(e[34]=[i("Medium",-1)])]),_:1}),t(s(u),{value:"Low"},{default:l(()=>[...e[35]||(e[35]=[i("Low",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),a("div",_e," Showing "+p($.value.length)+" of "+p(g.value.length)+" ticket(s) ",1),V.value?(m(),y("div",xe,[...e[36]||(e[36]=[a("p",{class:"text-muted-foreground"},"Loading tickets...",-1)])])):g.value.length===0?(m(),y("div",we,[e[38]||(e[38]=a("p",{class:"text-muted-foreground mb-4"},"No tickets yet",-1)),t(s(k),{onClick:e[8]||(e[8]=r=>_.value=!0)},{default:l(()=>[...e[37]||(e[37]=[i("Create Your First Ticket",-1)])]),_:1})])):$.value.length===0?(m(),y("div",be,[e[40]||(e[40]=a("p",{class:"text-muted-foreground mb-4"},"No tickets match your filters",-1)),t(s(k),{variant:"outline",onClick:e[9]||(e[9]=r=>{x.value="",w.value="all",b.value="all"})},{default:l(()=>[...e[39]||(e[39]=[i("Clear Filters",-1)])]),_:1})])):(m(),y("div",ke,[(m(!0),y(U,null,Y($.value,r=>(m(),y("div",{key:r.id,onClick:n=>q(r.id),class:"p-4 border rounded-lg hover:bg-accent cursor-pointer transition-colors"},[a("div",Ve,[a("div",$e,[a("div",je,[a("h3",Te,p(r.subject),1),t(s(N),{variant:A(r.status)},{default:l(()=>[i(p(r.status),1)]),_:2},1032,["variant"]),r.priority==="High"?(m(),K(s(N),{key:0,variant:"destructive",class:"text-xs"},{default:l(()=>[...e[41]||(e[41]=[i("High Priority",-1)])]),_:1})):W("",!0)]),a("p",Le,p(r.description),1),a("div",De,[a("span",null,"Created by "+p(r.creator?.name||"Unknown"),1),e[42]||(e[42]=a("span",null,"•",-1)),a("span",{class:X(E(r.priority))},p(r.priority)+" Priority",3),e[43]||(e[43]=a("span",null,"•",-1)),a("span",null,p(new Date(r.created_at).toLocaleDateString()),1)])])])],8,Ce))),128))]))])]),_:1})],64))}});export{Ye as default};
