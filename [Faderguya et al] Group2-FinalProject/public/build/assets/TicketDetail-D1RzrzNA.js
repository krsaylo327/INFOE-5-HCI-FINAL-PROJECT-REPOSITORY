import{_ as q}from"./AppLayout.vue_vue_type_script_setup_true_lang-BDv_a608.js";import{d as G,m as J,r as b,c as v,o as K,a as c,b as s,u as e,h as Q,w as a,i,e as o,t as d,f as r,p as w,k as C,F as L,j as X,g as S,l as T}from"./app-BROu12nU.js";import{_ as D}from"./index-C_7nduq-.js";import{_ as Y}from"./index-BE-gfsH9.js";import{_,a as k,b as y,c as g}from"./CardTitle.vue_vue_type_script_setup_true_lang-BKih_dnt.js";import{_ as Z}from"./Textarea.vue_vue_type_script_setup_true_lang-BE676KUH.js";import{_ as A,a as B,b as F,c as N,d as f}from"./SelectValue.vue_vue_type_script_setup_true_lang-B0jFY1N7.js";import{_ as tt}from"./Label.vue_vue_type_script_setup_true_lang-CyM4qNL3.js";import"./index-BMdsnYYQ.js";import"./VisuallyHidden-Bv5znWlI.js";import"./useForwardExpose-BNyMVrtm.js";import"./useForwardPropsEmits-DkhaOHi9.js";import"./index-BDXRdVD0.js";import"./check-CqkxZVO9.js";import"./useFormControl-CsNtCUd_.js";const et={key:0,class:"flex items-center justify-center py-12"},st={key:1,class:"p-6 space-y-6"},at={class:"flex items-start justify-between"},lt={class:"space-y-1"},ot={class:"flex items-center gap-2"},nt={class:"text-3xl font-bold"},rt={class:"text-muted-foreground"},it={class:"flex gap-2"},ut={class:"grid gap-6 md:grid-cols-3"},dt={class:"md:col-span-2 space-y-6"},ct={class:"whitespace-pre-wrap"},mt={key:0,class:"mt-4 pt-4 border-t"},ft=["href"],pt=["src"],vt={key:0},_t={class:"flex items-center justify-between"},kt={class:"font-semibold"},yt={class:"text-xs text-muted-foreground"},gt={class:"text-sm whitespace-pre-wrap"},xt={key:1,class:"text-muted-foreground text-center py-4"},$t={class:"space-y-2 pt-4 border-t"},bt={class:"space-y-4"},wt={key:1,class:"text-lg font-semibold"},Ct={class:"text-xs text-muted-foreground"},Tt={key:2,class:"flex flex-col items-center justify-center py-12"},Ut=G({__name:"TicketDetail",props:{ticketId:{}},setup(E){const m=E,O=J(),l=b(null),I=b(!0),p=b(""),x=b(!1),$=v(()=>O.props.auth.user),h=v(()=>$.value?.role==="admin"),P=v(()=>$.value?.role==="faculty"),R=v(()=>l.value?.user_id===$.value?.id),U=v(()=>l.value?h.value||R.value&&l.value.status==="Open"||P.value&&l.value.assigned_to===$.value?.id:!1),M=[{title:"Tickets",href:"/tickets"},{title:`Ticket #${m.ticketId}`,href:`/tickets/${m.ticketId}`}],V=async()=>{try{I.value=!0,console.log("Fetching ticket:",m.ticketId);const n=await T.get(`/api/tickets/${m.ticketId}`);l.value=n.data}catch(n){console.error("Error fetching ticket:",n),console.error("Status:",n.response?.status),console.error("Response:",n.response?.data),n.response?.status===404&&alert("Ticket not found or you do not have permission to view it.")}finally{I.value=!1}},H=async()=>{if(p.value.trim())try{x.value=!0,await T.post(`/api/tickets/${m.ticketId}/comments`,{content:p.value}),p.value="",await V()}catch(n){console.error("Error adding comment:",n),console.error("Validation errors:",n.response?.data?.errors),alert(`Error: ${n.response?.data?.message||"Failed to add comment"}`)}finally{x.value=!1}},j=async(n,t)=>{try{await T.patch(`/api/tickets/${m.ticketId}`,{[n]:t}),await V()}catch(u){console.error("Error updating ticket:",u)}},z=async()=>{if(confirm("Are you sure you want to delete this ticket?"))try{await T.delete(`/api/tickets/${m.ticketId}`),S.visit("/tickets")}catch(n){console.error("Error deleting ticket:",n)}},W=n=>({Open:"default","In Progress":"secondary",Resolved:"outline",Closed:"destructive"})[n]||"default";return K(()=>{V()}),(n,t)=>(i(),c(L,null,[s(e(Q),{title:`Ticket #${E.ticketId}`},null,8,["title"]),s(q,{breadcrumbs:M},{default:a(()=>[I.value?(i(),c("div",et,[...t[4]||(t[4]=[o("p",{class:"text-muted-foreground"},"Loading ticket...",-1)])])):l.value?(i(),c("div",st,[o("div",at,[o("div",lt,[o("div",ot,[o("h1",nt,d(l.value.subject),1),s(e(Y),{variant:W(l.value.status)},{default:a(()=>[r(d(l.value.status),1)]),_:1},8,["variant"])]),o("p",rt," Created by "+d(l.value.creator?.name)+" on "+d(new Date(l.value.created_at).toLocaleDateString()),1)]),o("div",it,[h.value?(i(),w(e(D),{key:0,variant:"destructive",onClick:z},{default:a(()=>[...t[5]||(t[5]=[r("Delete",-1)])]),_:1})):C("",!0)])]),o("div",ut,[o("div",dt,[s(e(_),null,{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(y),null,{default:a(()=>[...t[6]||(t[6]=[r("Description",-1)])]),_:1})]),_:1}),s(e(g),null,{default:a(()=>[o("p",ct,d(l.value.description),1),l.value.attachment?(i(),c("div",mt,[t[7]||(t[7]=o("p",{class:"text-sm font-semibold mb-2"},"Attachment:",-1)),o("a",{href:`/storage/${l.value.attachment}`,target:"_blank",class:"inline-block"},[o("img",{src:`/storage/${l.value.attachment}`,alt:"Ticket attachment",class:"max-w-md rounded-lg border hover:opacity-90 transition-opacity cursor-pointer"},null,8,pt)],8,ft),t[8]||(t[8]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Click to view full size",-1))])):C("",!0)]),_:1})]),_:1}),s(e(_),null,{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(y),null,{default:a(()=>[...t[9]||(t[9]=[r("Comments",-1)])]),_:1})]),_:1}),s(e(g),{class:"space-y-4"},{default:a(()=>[l.value.comments&&l.value.comments.length>0?(i(),c("div",vt,[(i(!0),c(L,null,X(l.value.comments,u=>(i(),c("div",{key:u.id,class:"p-4 border rounded-lg space-y-2"},[o("div",_t,[o("span",kt,d(u.user?.name),1),o("span",yt,d(new Date(u.created_at).toLocaleString()),1)]),o("p",gt,d(u.content),1)]))),128))])):(i(),c("p",xt,"No comments yet")),o("div",$t,[s(e(tt),null,{default:a(()=>[...t[10]||(t[10]=[r("Add Comment",-1)])]),_:1}),s(e(Z),{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=u=>p.value=u),placeholder:"Write your comment...",rows:"3"},null,8,["modelValue"]),s(e(D),{onClick:H,disabled:!p.value.trim()||x.value,class:"w-full"},{default:a(()=>[r(d(x.value?"Posting...":"Post Comment"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1})]),o("div",bt,[s(e(_),null,{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(y),null,{default:a(()=>[...t[11]||(t[11]=[r("Priority",-1)])]),_:1})]),_:1}),s(e(g),null,{default:a(()=>[U.value?(i(),w(e(A),{key:0,"model-value":l.value.priority,"onUpdate:modelValue":t[1]||(t[1]=u=>j("priority",u))},{default:a(()=>[s(e(B),null,{default:a(()=>[s(e(F))]),_:1}),s(e(N),null,{default:a(()=>[s(e(f),{value:"Low"},{default:a(()=>[...t[12]||(t[12]=[r("Low",-1)])]),_:1}),s(e(f),{value:"Medium"},{default:a(()=>[...t[13]||(t[13]=[r("Medium",-1)])]),_:1}),s(e(f),{value:"High"},{default:a(()=>[...t[14]||(t[14]=[r("High",-1)])]),_:1})]),_:1})]),_:1},8,["model-value"])):(i(),c("p",wt,d(l.value.priority),1))]),_:1})]),_:1}),h.value||P.value?(i(),w(e(_),{key:0},{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(y),null,{default:a(()=>[...t[15]||(t[15]=[r("Status",-1)])]),_:1})]),_:1}),s(e(g),null,{default:a(()=>[s(e(A),{"model-value":l.value.status,"onUpdate:modelValue":t[2]||(t[2]=u=>j("status",u))},{default:a(()=>[s(e(B),null,{default:a(()=>[s(e(F))]),_:1}),s(e(N),null,{default:a(()=>[s(e(f),{value:"Open"},{default:a(()=>[...t[16]||(t[16]=[r("Open",-1)])]),_:1}),s(e(f),{value:"In Progress"},{default:a(()=>[...t[17]||(t[17]=[r("In Progress",-1)])]),_:1}),s(e(f),{value:"Resolved"},{default:a(()=>[...t[18]||(t[18]=[r("Resolved",-1)])]),_:1}),s(e(f),{value:"Closed"},{default:a(()=>[...t[19]||(t[19]=[r("Closed",-1)])]),_:1})]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1})):C("",!0),l.value.assigned_to?(i(),w(e(_),{key:1},{default:a(()=>[s(e(k),null,{default:a(()=>[s(e(y),null,{default:a(()=>[...t[20]||(t[20]=[r("Assigned To",-1)])]),_:1})]),_:1}),s(e(g),null,{default:a(()=>[o("p",null,d(l.value.assignedTo?.name||"Unassigned"),1),o("p",Ct,d(l.value.assignedTo?.role),1)]),_:1})]),_:1})):C("",!0)])])])):(i(),c("div",Tt,[t[22]||(t[22]=o("p",{class:"text-muted-foreground"},"Ticket not found",-1)),s(e(D),{onClick:t[3]||(t[3]=u=>e(S).visit("/tickets")),class:"mt-4"},{default:a(()=>[...t[21]||(t[21]=[r("Back to Tickets",-1)])]),_:1})]))]),_:1})],64))}});export{Ut as default};
